<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title></title></head><body>{%macro book_list(result)%}<div class="album py-5 bg-body-tertiary"><div class="container"><div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3">{%for book in result%}<div class="col"><div class="card shadow-sm"><svg class="bd-placeholder-img card-img-top"width="100%"height="225"xmlns="http://www.w3.org/2000/svg"role="img"aria-label="Placeholder: Thumbnail"preserveAspectRatio="xMidYMid slice"focusable="false"><title>Placeholder</title><rect width="100%"height="100%"fill="#55595c"></rect><text x="50%"y="50%"fill="#eceeef"dy=".3em">{{book.title}}</text></svg><div class="card-body"><p class="card-text">{{book.author}}</p><div class="d-flex justify-content-between align-items-center"><div class="btn-group"><button class="btn btn-outline-secondary"name="view"data-bs-toggle="modal"data-bs-target="#drop"title="{{ book.id }}">查看</button>{%if session.user_info.role_id==3%}<button class="btn btn-outline-secondary"title="{{ book.id }}"name="lend">借取</button>{%endif%}</div><small class="text-body-secondary">出版时间：{{book.publication_date}}</small></div></div></div></div>{%endfor%}</div></div></div><script src="/static/layui-v2.9.7/layui/layui.js"></script><script>layui.use(function(){const layer=layui.layer;const util=layui.util;const $=layui.$;$("button[name='view']").unbind().click(function(){$.ajax({url:"/api/v1/books/view/"+$(this).attr("title"),method:"GET",success:function(d){for(let i=0;i<d.length;i++){$("#title").val(d[i].title);$("#author").val(d[i].author);$("#publication_date").val(d[i].publication_date);document.querySelector('select').value=d[i].type;$("#description").val(d[i].description)}}})});$("button[name='lend']").unbind().click(function(){const curr=$(this);layer.confirm('确定借阅该书籍吗?',{icon:3},function(idx){curr.prop("disabled",true);$.ajax({url:"/api/v1/lending/lend/"+curr.attr("title"),method:"GET",success:function(d){layer.close(idx);layer.load(1);setTimeout(function(){layer.closeAll();layer.msg("借取成功");curr.text("已借阅").removeClass("btn-outline-secondary").addClass("btn-success")},3000)}})})})})</script>{%endmacro%}{%macro book_modal(type_list)%}<div class="modal fade"id="drop"data-bs-keyboard="false"tabindex="-1"aria-labelledby="staticBackdropLabel"aria-hidden="true"><div class="modal-dialog modal-dialog-centered modal-dialog-scrollable"><div class="modal-content"><div class="modal-body"><div class="mb-3"><label class="form-label">标题</label><input id="title"class="form-control"readonly></div><div class="mb-3"><label class="form-label">作者</label><input id="author"class="form-control"readonly></div><div class="mb-3"><label class="form-label">出版日期</label><input id="publication_date"class="form-control"type="date"readonly></div><div class="mb-3"><label class="form-label">分类</label><select class="form-select"disabled>{%for ty in type_list%}<option value="{{ ty.id }}">{{ty.category_name}}</option>{%endfor%}</select></div><div class="mb-3"><label for=""class="form-label">简介</label><textarea id="description"class="form-control"readonly></textarea></div></div></div></div></div>{%endmacro%}</body></html>