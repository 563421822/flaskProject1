<!DOCTYPE html><html><head><meta charset="utf-8"><title></title><meta name="renderer"content="webkit"><meta http-equiv="X-UA-Compatible"content="IE=edge,chrome=1"><meta name="viewport"content="width=device-width, initial-scale=1"><link href="/static/layui-v2.9.7/layui/css/layui.css"rel="stylesheet"></head><body><div style="padding: 16px;"><table class="layui-hide"id="test"lay-filter="test"></table></div><script type="text/html"id="toolbarDemo"><div class="layui-btn-container"><button class="layui-btn layui-btn-sm"lay-event="getCheckData">获取选中行数据</button><button class="layui-btn layui-btn-sm"lay-event="getData">获取当前页数据</button><button class="layui-btn layui-btn-sm"id="dropdownButton">下拉按钮<i class="layui-icon layui-icon-down layui-font-12"></i></button></div></script><script type="text/html"id="barDemo"><div class="layui-clear-space"><a class="layui-btn layui-btn-xs"lay-event="edit">编辑</a><a class="layui-btn layui-btn-xs"lay-event="more">更多<i class="layui-icon layui-icon-down"></i></a></div></script><script src="/static/layui-v2.9.7/layui/layui.js"></script><script>layui.use(['table','dropdown'],function(){const table=layui.table;const dropdown=layui.dropdown;const $=layui.$;table.render({elem:'#test',url:'/api/v1/users/gtAlUsers',toolbar:'#toolbarDemo',defaultToolbar:['filter','exports','print',{title:'提示',layEvent:'LAYTABLE_TIPS',icon:'layui-icon-tips'}],height:'full-35',css:['.layui-table-tool-temp{padding-right: 145px;}'].join(''),cellMinWidth:80,page:{layout:['limit','count','prev','page','next','skip'],groups:3,first:false,last:false},cols:[[{type:'checkbox',fixed:'left'},{field:'id',fixed:'left',width:80,title:'ID',sort:true},{field:'username',width:80,title:'用户名'},{field:'email',title:'邮箱 <i class="layui-icon layui-icon-tips layui-font-14" lay-event="email-tips" title="该字段开启了编辑功能" style="margin-left: 5px;"></i>',fieldTitle:'邮箱',hide:0,expandedMode:'tips',edit:'text'},{field:'age',title:'年龄',sort:true},{field:'gender',title:'性别'},{field:'role_name',title:'角色'},{field:'registration_date',title:'注册日期',sort:true},{field:'last_login',title:'上次登录时间',sort:true},{fixed:'right',title:'操作',width:134,minWidth:125,toolbar:'#barDemo'}]],done:function(){const id=this.id;dropdown.render({elem:'#dropdownButton',data:[{id:'add',title:'添加'},{id:'delete',title:'删除'}],click:function(obj){const checkStatus=table.checkStatus(id);const data=checkStatus.data;switch(obj.id){case'add':layer.open({title:'添加',type:2,area:['80%','80%'],content:'/static/common/layer_content.html',btn:['提交','取消'],btnAlign:'c',yes:function(index,layero){const iframeWin=window[layero.find('iframe')[0]['name']];iframeWin.document.getElementById("dtlForm").action="/api/v1/users/add";iframeWin.document.getElementById("dtlForm").submit();layer.close(index);const loadIndex=layer.load(0);setTimeout(function(){layer.close(loadIndex);table.reload('test')},500)}});break;case'delete':if(data.length===0){return layer.msg('请选择一行')}for(let dataKey in data){fetch("/api/v1/users/del/"+data[dataKey].id).then(response=>response.json()).then(data=>{console.log("Received data:",data)}).catch(error=>{console.error("Error:",error)})}table.reload("test");break}}})},error:function(res,msg){console.log(res,msg)}});table.on('toolbar(test)',function(obj){const id=obj.config.id;const checkStatus=table.checkStatus(id);const othis=lay(this);switch(obj.event){case'getCheckData':const data=checkStatus.data;layer.alert(layui.util.escape(JSON.stringify(data)));break;case'getData':const getData=table.getData(id);console.log(getData);layer.alert(layui.util.escape(JSON.stringify(getData)));break;case'LAYTABLE_TIPS':layer.alert('自定义工具栏图标按钮');break}});table.on('colTool(test)',function(obj){const event=obj.event;console.log(obj);if(event==='email-tips'){layer.alert(layui.util.escape(JSON.stringify(obj.col)),{title:'当前列属性配置项'})}});table.on('tool(test)',function(obj){const data=obj.data;console.info(data);if(obj.event==='edit'){layer.open({type:2,area:['80%','80%'],content:'/static/common/layer_content.html',maxmin:true,shadeClose:true,btn:['提交','取消'],btnAlign:'c',success:function(el,index){const iframeWin=window[el.find('iframe')[0]['name']];const strArr=["id","username","email","age","gender","role_id"];strArr.forEach(function(s){iframeWin.document.getElementsByName(s)[0].value=data[s]})},yes:function(index,layero){const iframeWin=window[layero.find('iframe')[0]['name']];iframeWin.document.getElementById("dtlForm").submit();layer.close(index);const loadIndex=layer.load(0);setTimeout(function(){layer.close(loadIndex);table.reload('test')},500)}})}else if(obj.event==='more'){dropdown.render({elem:this,show:true,data:[{title:'删除',id:'del'}],click:function(menudata){if(menudata.id==='del'){layer.confirm('确定删除 [id: '+data.id+'] 吗',function(index){obj.del();layer.close(index);$.get({url:"/api/v1/users/del/"+data.id,success:function(d){if(d.code===0)table.reload('test')}})})}},align:'right',style:'box-shadow: 1px 1px 10px rgb(0 0 0 / 12%);'})}});table.on('checkbox(test)',function(obj){console.log(obj)});table.on('radio(test)',function(obj){console.log(obj)});table.on('row(test)',function(obj){});table.on('rowDouble(test)',function(obj){console.log(obj)});table.on('edit(test)',function(obj){const field=obj.field;const value=obj.value;const data=obj.data;if(field==='email'){if(!/^([a-zA-Z0-9_.\-])+@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(obj.value)){layer.tips('输入的邮箱格式不正确，请重新编辑',this,{tips:1});return obj.reedit()}}layer.msg('编辑成功',{icon:1});const update={};update[field]=value;obj.update(update)})});</script></body></html>